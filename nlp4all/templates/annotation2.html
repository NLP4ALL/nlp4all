
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>



<form name="annform" id="annform">
    <input type="button" value="Get selected words" onmousedown="getSelText()" id="btn" method="post" action ="">
    <br> 
    <textarea id="anntext" name="anntext" rows="2" cols="30"></textarea>
    <br>
    <select name="atag" id="atag" onchange="var val = this.options[this.selectedIndex].value;
    this.form.color[1].style.display=(val=='others')?'block':'none'"> 
        <option>Tag your annotation</option>  
        {% for c in tag_list %}
        <option value={{ c }}>{{ c }}</option>
        {% endfor %}
    </select> 
    <input type="hidden" id="pos" value="">
    <input type="button" id="submitbtn" value="Save annotation">
</form>

<script>
    $("#cat-btn").click(function() {
        var cat_id = $("#sel-cat");
        var cat_btn = $("#cat-btn");
        var catid = cat_id.val()
        console.log(catid);
        
        cat_btn.attr('value',catid);
       
    });
    // this requires that the tweet is required in the top template
    var annotation = $("#anntext");
    var submitbtn = $("#submitbtn");
    var tpl = $("#tpl");
    
    
    var atag;
    function getSelText()
    
      {
          var txt = '';
          
           if (window.getSelection)
          {
              txt = window.getSelection().toString();
              parent = window.getSelection().anchorNode.parentElement.id;
              
                   }
          else if (document.getSelection)
          {
              txt = window.getSelection().toString();
              parent = window.getSelection().anchorNode.parentElement.id;
             
                  }
          else if (document.selection)
          {
              txt = window.getSelection().toString();
              parent = window.getSelection().anchorNode.parentElement.id;
             
                  }
          else return;
        console.log(txt, parent);
        
        document.annform.anntext.value =  txt;
        document.annform.pos.value = parent
        console.log(document.annform.anntext.value);
        
        
      };
      
    var sel = document.getElementById('atag');
    sel.onchange=function() {
        
            var tweet_id = $("#draggable-tweet").attr('tweet_id').valueOf();
            console.log("tagtweetid", tweet_id);
            var val = this.options[this.selectedIndex].value;
            
            atag = sel.options[sel.selectedIndex].value;
            console.log(atag)
            };
    
    submitbtn.click(function()  {
        var tweet_id = $("#draggable-tweet").attr('tweet_id');
        $.get('/save_annotation', {'tweet_id': tweet_id, 'text': document.annform.anntext.value, 'atag': atag , 'pos': document.annform.pos.value, 'analysis': {{ analysis.id }} } ).done(
            function(returnedData) {
                console.log(returnedData[1]);

            });

            $("#annform").trigger("reset");
            sel.selectedIndex = "Tag your annotation";
            sel.options[sel.selectedIndex].value = 0
            console.log(sel.selectedIndex)

    });




</script>


