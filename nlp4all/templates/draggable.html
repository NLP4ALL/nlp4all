

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  

<script>
    // contain within a specific container
    $('#draggable-containment').draggable({
        containment: '.draggable-container',
    });

  const item = document.querySelector('.dragme');

  function dragStart(ev) {
    console.log('drag starts...');
    setTimeout(() => {
        ev.target.classList.add('hide');
    }, 1);
  }

  function dragStop(ev) {
    console.log('drag stops...');
    item.classList.remove('hide');
  }

  // change dragged object color
  $( "#pieChart" ).on( "dragover", function(evt) {
                var activePoints = myPieChart.getElementsAtEvent(evt);
                if(activePoints.length > 0)
                {
                    var clickedElementindex = activePoints[0]["_index"];
                    var label = myPieChart.data.labels[clickedElementindex];
                    $('#cat').attr("value", label)
                    var value = myPieChart.data.datasets[0].data[clickedElementindex];
                   console.log(label + ' - ' + value);
                   $('#jquery-tweet').css("background-color", myPieChart.data.datasets[0].backgroundColor[clickedElementindex]);
                }
            });


  function allowDrop(ev) {
    
    console.log("you can drop it now");  
    item.classList.add('hide');
    //to do wait 3 sec before triggering event
    ev.preventDefault();
    console.log("you're on it!", ev.dataTransfer.getData("text"));  
        
  }

  function drag(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
    setTimeout(() => {  
     // ev.target.classList.add('hide');
    }, 1000);
  }
  
  function drop(ev) {
    ev.preventDefault();
    $("#tuples").empty();
    //var data = ev.dataTransfer.getData("text");
    //console.log("drop!"+data+ev.target)
    //ev.target.appendChild(document.getElementById(data));

    $('#jquery-tweet').css("background-color",'hsl(0, 100%, 100%)');
    
    var t_id = $("#draggable-tweet").attr('tweet_id');
    var cat = $("#cat").attr('value');
    console.log(t_id);
    console.log(cat);

   
    //var t_id = $("#draggable-tweet").attr('t_id');
    //var cat = $("#cat").attr('value');
    $.get('/save_draggable_tweet', {'analysis_id': {{ analysis.id }}, 'tweet_id': t_id, 'category': cat }).done(
        function(returnedData) {
            console.log('tags: '+returnedData[0]['number_of_tagged']) //.append( "<p>Test</p>" );
            document.getElementById('time-posted').innerText = returnedData[2] 
              for(var i=0; i<returnedData[0]['word_tuples'].length; i++){
                  console.log('<span class="'+returnedData[0]['word_tuples'][i][1]+'-'+returnedData[0]['word_tuples'][i][2]+'" title="'+returnedData[0]['word_tuples'][i][1]+'='+returnedData[0]['word_tuples'][i][2]+'%" value='+returnedData[0]['word_tuples'][i][4]+' id='+returnedData[0]['word_tuples'][i][4]+'>'+returnedData[0]["word_tuples"][i][0]+' '+'</span>')
                  var tup_color =  'hsl('+returnedData[0]["word_tuples"][i][3]+', '+((returnedData[0]["word_tuples"][i][2]- 50) * 2)+'% , 50%)'
                  console.log(tup_color)
                  $("#tuples").append('<span class="'+returnedData[0]['word_tuples'][i][1]+'-'+returnedData[0]['word_tuples'][i][2]+'" title="'+returnedData[0]['word_tuples'][i][1]+'='+returnedData[0]['word_tuples'][i][2]+'%" value='+returnedData[0]['word_tuples'][i][4]+' id='+returnedData[0]['word_tuples'][i][4]+' color='+tup_color+'>'+returnedData[0]["word_tuples"][i][0]+' '+'</span>')
                }
                $("#draggable-tweet").attr('tweet_id', returnedData[1]);
                console.log('tweet is ' +$("#draggable-tweet").attr('tweet_id'));
             
        });
  };
    
  window.onload = function() {
      $.get('/get_first_tweet', {'analysis_id': {{ analysis.id }}}).done(
        function(returnedData) {
          for(var i=0; i<returnedData[0]['word_tuples'].length; i++){
                  console.log('<span class="'+returnedData[0]['word_tuples'][i][1]+'-'+returnedData[0]['word_tuples'][i][2]+'" title="'+returnedData[0]['word_tuples'][i][1]+'='+returnedData[0]['word_tuples'][i][2]+'%" value='+returnedData[0]['word_tuples'][i][4]+' id='+returnedData[0]['word_tuples'][i][4]+'>'+returnedData[0]["word_tuples"][i][0]+' '+'</span>')
                  var tup_color =  'hsl('+returnedData[0]["word_tuples"][i][3]+', '+((returnedData[0]["word_tuples"][i][2]- 50) * 2)+'% , 50%)'
                  console.log(tup_color)
                  $("#tuples").append('<span class="'+returnedData[0]['word_tuples'][i][1]+'-'+returnedData[0]['word_tuples'][i][2]+'" title="'+returnedData[0]['word_tuples'][i][1]+'='+returnedData[0]['word_tuples'][i][2]+'%" value='+returnedData[0]['word_tuples'][i][4]+' id='+returnedData[0]['word_tuples'][i][4]+' color='+tup_color+'>'+returnedData[0]["word_tuples"][i][0]+' '+'</span>')
                }
                $("#draggable-tweet").attr('tweet_id', returnedData[1]);
                console.log('tweet is ' +$("#draggable-tweet").attr('tweet_id'));

        });
  };

</script>

<style>
    .dropbox {
      width: 350px;
      height: 70px;
      padding: 10px;
      border: 1px solid #aaaaaa;
    
    }
    .dragme {
      width: 50px;
      height: 50px;
      padding: 10px;
      margin:auto;
      color:cadetblue;
      border: 1px solid #aaaaaa;
      align-self: center;

    }
    .hide {
    display: none;
  }
    </style>






